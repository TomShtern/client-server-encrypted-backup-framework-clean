<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberBackup Pro - v3.0 (API Driven)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="cyber-grid"></div>
    <div class="particle-container" id="particleContainer"></div>
    <div class="toast-container" id="toastContainer" role="status" aria-live="polite"></div>
    <div aria-live="polite" aria-atomic="true" class="sr-only" id="announcements"></div>
    
    <div class="container">
        <!-- Header -->
        <header class="header" role="banner">
            <div class="logo">
                <div class="logo-icon neon-text pink" tabindex="0" role="button" aria-label="CyberBackup Logo">‚ö°</div>
                <div class="logo-text">
                    <h1 class="neon-text pink">CYBERBACKUP PRO</h1>
                    <div class="subtitle">v3.0 (API Driven)</div>
                </div>
            </div>
            <div class="connection-status">
                <div class="status-led" id="connectionLed" aria-label="Connection status"></div>
                <span id="connectionText" style="font-weight: 600;">OFFLINE</span>
            </div>
        </header>

        <!-- Configuration Panel -->
        <aside class="config-panel glass-card" role="region" aria-label="Configuration">
            <div class="panel-header">
                <h2 class="panel-title">System Configuration</h2>
            </div>
            
            <div class="config-section">
                <label class="config-label" for="serverInput">Server Address</label>
                <input type="text" class="config-input" id="serverInput" 
                       placeholder="127.0.0.1:1256" value="127.0.0.1:1256" aria-describedby="serverHelp">
                <div id="serverHelp" class="sr-only">Enter server IP address and port</div>
            </div>
            
            <div class="config-section">
                <label class="config-label" for="usernameInput">Username</label>
                <input type="text" class="config-input" id="usernameInput" 
                       placeholder="Enter username" value="testuser" maxlength="100" aria-describedby="usernameHelp">
                <div id="usernameHelp" class="sr-only">Username for authentication (max 100 characters)</div>
            </div>
            
            <div class="config-section">
                <label class="config-label">Target File</label>
                <div class="file-drop-zone" id="fileDropZone">
                    <input type="file" class="file-input" id="fileInput" 
                           aria-describedby="fileHelp" accept="*/*">
                    <div class="file-button" onclick="gui.selectFile()">
                        üìÅ Select File to Backup
                        <span class="sr-only">or drag and drop a file here</span>
                    </div>
                </div>
                <div id="fileHelp" class="sr-only">Select a file for backup or drag and drop</div>
                <div class="config-value" id="selectedFile">No file selected</div>
                <div id="filePreview" class="file-preview-container" style="margin-top: var(--space-md); text-align: center; min-height: 60px; display: flex; align-items: center; justify-content: center;"></div>
            </div>
            
            <div class="config-section">
                <label class="config-label">Client ID</label>
                <div class="config-value" id="clientId">Not connected</div>
            </div>

            <div class="btn-group">
                <button class="cyber-btn success" onclick="gui.saveConfiguration()">üíæ Save Config</button>
            </div>

            <div class="panel-header" style="margin-top: var(--space-xl);">
                <h2 class="panel-title">Theme Selection</h2>
            </div>
            
            <div class="theme-selector">
                <button class="theme-btn cyberpunk active" onclick="gui.setTheme('cyberpunk')" 
                        aria-label="Cyberpunk theme" title="Cyberpunk Theme"></button>
                <button class="theme-btn dark" onclick="gui.setTheme('dark')" 
                        aria-label="Dark theme" title="Dark Theme"></button>
                <button class="theme-btn matrix" onclick="gui.setTheme('matrix')" 
                        aria-label="Matrix theme" title="Matrix Theme"></button>
            </div>
        </aside>

        <!-- Main Panel -->
        <main class="main-panel glass-card" role="main">
            <div class="phase-display" id="currentPhase">
                <span class="neon-text purple">SYSTEM READY</span>
            </div>
            
            <div class="progress-container">
                <svg class="progress-ring" viewBox="0 0 300 300" role="img" aria-label="Transfer progress">
                    <defs>
                        <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:var(--neon-blue);stop-opacity:1" />
                            <stop offset="33%" style="stop-color:var(--neon-purple);stop-opacity:1" />
                            <stop offset="66%" style="stop-color:var(--neon-pink);stop-opacity:1" />
                            <stop offset="100%" style="stop-color:var(--neon-green);stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle class="progress-bg" cx="150" cy="150" r="130" 
                            fill="none" stroke="var(--bg-light)" stroke-width="16"></circle>
                    <circle class="progress-fill" cx="150" cy="150" r="130" id="progressCircle"></circle>
                </svg>
                <div class="progress-text">
                    <div class="progress-percentage neon-text" id="progressPercentage">0%</div>
                    <div class="progress-label" id="progressStatus">READY</div>
                </div>
            </div>
            
            <div class="control-panel">
                <button class="cyber-btn primary large control-btn" id="primaryAction" onclick="
                    alert('Button clicked!'); 
                    try {
                        if (window.gui) {
                            alert('GUI object found, calling handlePrimaryAction...');
                            window.gui.handlePrimaryAction();
                            alert('handlePrimaryAction completed successfully');
                        } else {
                            alert('ERROR: gui object not found!');
                        }
                    } catch (error) {
                        alert('ERROR in handlePrimaryAction: ' + error.message);
                    }
                ">
                    <span class="btn-icon">üöÄ</span>
                    <span class="btn-text">CONNECT</span>
                </button>
                <button class="cyber-btn secondary large control-btn" id="pauseBtn" onclick="gui.pauseOperation()" disabled>
                    <span class="btn-icon">‚è∏Ô∏è</span>
                    <span class="btn-text">PAUSE</span>
                </button>
                <button class="cyber-btn danger large control-btn" id="stopBtn" onclick="gui.stopOperation()" disabled>
                    <span class="btn-icon">üõë</span>
                    <span class="btn-text">STOP</span>
                </button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="speedStat">0 B/s</div>
                    <div class="stat-label">Transfer Speed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="etaStat">--:--</div>
                    <div class="stat-label">ETA</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="transferredStat">0 B</div>
                    <div class="stat-label">Transferred</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sizeStat">0 B</div>
                    <div class="stat-label">Total Size</div>
                </div>
            </div>
        </main>

        <!-- Status Panel -->
        <aside class="status-panel glass-card" role="region" aria-label="Operation log">
            <div class="panel-header">
                <h2 class="panel-title">Operation Log</h2>
                <div class="btn-group">
                    <button class="cyber-btn success small" onclick="gui.exportLog()">üì• Export</button>
                    <button class="cyber-btn danger small" onclick="gui.clearLog()">üóëÔ∏è Clear</button>
                    <button class="cyber-btn primary small" onclick="gui.toggleAutoScroll()" id="autoScrollBtn">
                        üìú Auto-scroll: ON
                    </button>
                </div>
            </div>
            
            <div class="log-container" id="logContainer" role="log" aria-live="polite" aria-label="Activity log">
                <!-- Logs will be populated here -->
            </div>
        </aside>

        <!-- Debug Panel -->
        <div class="debug-panel glass-card" role="region" aria-label="Developer console">
            <div class="panel-header">
                <h2 class="panel-title">Developer Console</h2>
                <button class="cyber-btn primary small" onclick="gui.toggleDebug()" id="debugToggle" 
                        aria-expanded="false">üîß Toggle Debug</button>
            </div>
            
            <div class="debug-content" id="debugContent">
                <div class="debug-grid">
                    <div class="debug-section">
                        <h3>üìä Last API Response</h3>
                        <div class="json-viewer" id="statusJsonViewer">Waiting for status data...</div>
                    </div>
                    <div class="debug-section">
                        <h3>üìà State Machine</h3>
                        <div class="json-viewer" id="progressJsonViewer">Waiting for state data...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Custom Confirmation Modal -->
    <div class="modal-overlay confirm-modal" id="confirmModal">
        <div class="modal">
            <h3 class="modal-title" id="confirmTitle">Confirm Action</h3>
            <p class="modal-message" id="confirmMessage">Are you sure?</p>
            <div class="modal-buttons">
                <button class="cyber-btn secondary" onclick="gui.hideConfirmModal()">Cancel</button>
                <button class="cyber-btn danger" id="confirmOkBtn" onclick="gui.confirmAction()">Confirm</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>