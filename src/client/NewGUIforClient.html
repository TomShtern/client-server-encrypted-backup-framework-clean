<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberBackup Pro - v3.0 (API Driven)</title>
    <style>
        /* CRITICAL FIX: Move @import to top */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Share+Tech+Mono:wght@400&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Enhanced Cyberpunk Color Palette */
            --neon-pink: #FF00FF;
            --neon-blue: #00FFFF;
            --neon-purple: #8A2BE2;
            --neon-green: #00FF00;
            --neon-yellow: #FFFF00;
            --neon-orange: #FF4500;
            --neon-red: #FF0040;
            --electric-blue: #0080FF;
            --cyber-lime: #32CD32;
            --plasma-pink: #FF1493;
            
            --bg-black: #000000;
            --bg-dark: #0A0A0A;
            --bg-medium: #1A1A2E;
            --bg-light: #16213E;
            --bg-card: rgba(26, 26, 46, 0.95);
            --bg-glass: rgba(255, 255, 255, 0.05);
            
            --text-primary: #FFFFFF;
            --text-secondary: #E0E0E0;
            --text-dim: #888888;
            --text-contrast: rgba(0, 0, 0, 0.8);
            
            --success: var(--neon-green);
            --warning: var(--neon-yellow);
            --error: var(--neon-red);
            --info: var(--neon-blue);
            
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-border-active: rgba(0, 255, 255, 0.6);
            
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s ease-out;
            
            /* Improved Spacing System */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Enhanced Border Radius System */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
        }

        body {
            font-family: 'Orbitron', 'Share Tech Mono', monospace;
            background: var(--bg-black);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto; /* Ensure proper scrolling */
            position: relative;
            font-size: 1.125rem; /* Increased base font size */
        }

        /* Enhanced Animated Background */
        .cyber-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 0, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 0, 0.1) 0%, transparent 50%),
                linear-gradient(var(--neon-pink) 1px, transparent 1px),
                linear-gradient(90deg, var(--neon-blue) 1px, transparent 1px);
            background-size: 
                100% 100%,
                100% 100%,
                100% 100%,
                100px 100px,
                100px 100px;
            opacity: 0.1;
            animation: cyber-grid-flow 30s linear infinite;
        }

        @keyframes cyber-grid-flow {
            0% { 
                transform: translate(0, 0) rotate(0deg);
                background-position: 0 0, 0 0, 0 0, 0 0, 0 0;
            }
            100% { 
                transform: translate(100px, 100px) rotate(0.5deg);
                background-position: 100px 100px, -50px 50px, 150px -100px, 100px 100px, 100px 100px;
            }
        }

        /* Enhanced Neon Text Effects */
        .neon-text {
            position: relative;
            color: var(--text-primary);
            text-shadow: var(--glow-blue);
            animation: neon-flicker 3s ease-in-out infinite alternate;
        }

        .neon-text.pink { 
            color: var(--neon-pink);
            text-shadow: var(--glow-pink);
        }

        .neon-text.green { 
            color: var(--neon-green);
            text-shadow: var(--glow-green);
        }

        .neon-text.purple { 
            color: var(--neon-purple);
            text-shadow: var(--glow-purple);
        }

        @keyframes neon-flicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
                opacity: 1;
                text-shadow: var(--glow-blue);
            }
            20%, 24%, 55% {        
                opacity: 0.4;
                text-shadow: none;
            }
        }

        /* Enhanced Accessibility: Better contrast backgrounds */
        .text-with-contrast {
            background: var(--text-contrast);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        /* IMPROVED CONTAINER - Better Spacing and Responsive Grid */
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: var(--space-md) var(--space-md) var(--space-xl); /* FIX: Added bottom padding to prevent clipping */
            display: grid;
            grid-template-columns: minmax(300px, 1fr) minmax(400px, 2fr) minmax(350px, 1fr);
            grid-template-rows: auto 1fr auto;
            gap: var(--space-md);
            min-height: 100vh;
            grid-template-areas: 
                "header header header"
                "config main status"
                "debug debug debug";
        }

        /* Enhanced Glass Card with RGB Border Animation and Drop Shadows */
        .glass-card {
            background: var(--bg-card);
            -webkit-backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 2px solid transparent;
            border-radius: var(--radius-xl);
            padding: var(--space-md);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
            background-clip: padding-box;
            /* FIX: Enhanced depth with more pronounced drop shadows */
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.5),
                0 2px 6px rgba(0, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, 
                var(--neon-pink), var(--neon-blue), var(--neon-purple), 
                var(--neon-green), var(--neon-yellow), var(--neon-pink));
            background-size: 400% 400%;
            border-radius: calc(var(--radius-xl) + 3px);
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s;
            animation: rgb-border-cycle 4s ease-in-out infinite;
        }

        .glass-card:hover::before,
        .glass-card.active::before {
            opacity: 0.7;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.5),
                0 4px 12px rgba(0, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        @keyframes rgb-border-cycle {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Particle Effect Container */
        .particle-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--neon-blue);
            border-radius: 50%;
            animation: particle-float 3s linear infinite;
        }

        @keyframes particle-float {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-10vh) scale(1);
                opacity: 0;
            }
        }

        /* Enhanced Header - Better Layout */
        .header {
            grid-area: header;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-xl);
            border-bottom: 3px solid transparent;
            background: linear-gradient(90deg, var(--bg-dark) 0%, var(--bg-medium) 100%);
            position: relative;
            border-image: linear-gradient(90deg, var(--neon-pink), var(--neon-blue), var(--neon-purple)) 1;
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-md);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }

        .logo-icon {
            font-size: 2.5rem;
            animation: logo-pulse 4s ease-in-out infinite;
            color: var(--neon-pink);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .logo-icon:hover {
            transform: scale(1.1);
            filter: drop-shadow(var(--glow-pink));
        }

        .logo-icon:focus {
            outline: 2px solid var(--neon-blue);
            outline-offset: 4px;
        }

        @keyframes logo-pulse {
            0%, 100% { 
                transform: scale(1);
                color: var(--neon-pink);
            }
            25% { 
                transform: scale(1.05);
                color: var(--neon-blue);
            }
            50% { 
                transform: scale(1.1);
                color: var(--neon-purple);
            }
            75% { 
                transform: scale(1.05);
                color: var(--neon-green);
            }
        }

        .logo-text h1 {
            font-size: 2rem;
            font-weight: 900;
            color: var(--neon-pink);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: var(--space-xs);
            position: relative;
        }

        .logo-text .subtitle {
            font-size: 0.875rem;
            color: var(--neon-blue);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-family: 'Share Tech Mono', monospace;
        }

        /* Enhanced Connection Status with Icons */
        .connection-status {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
            padding: var(--space-lg) var(--space-xl);
            background: var(--bg-card);
            border-radius: 50px;
            border: 2px solid var(--glass-border);
            transition: var(--transition);
        }

        .connection-status:hover {
            border-color: var(--glass-border-active);
            box-shadow: var(--glow-blue);
        }

        .status-led {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            background: var(--error);
            position: relative;
            animation: pulse-error 2s infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
            box-shadow: 
                0 0 10px rgba(255, 0, 64, 0.4),
                0 0 20px rgba(255, 0, 64, 0.2);
        }

        .status-led.connected {
            background: var(--success);
            animation: pulse-success 2s infinite;
            box-shadow: 
                var(--glow-green),
                0 0 15px rgba(0, 255, 0, 0.4);
        }

        .status-led.connecting {
            background: var(--warning);
            animation: pulse-warning 1s infinite;
            box-shadow: 
                0 0 10px rgba(255, 255, 0, 0.4),
                0 0 20px rgba(255, 255, 0, 0.2);
        }

        .status-led.connected::after {
            content: '‚úì';
        }

        .status-led.connecting::after {
            content: '‚ü≥';
            animation: spin 1s linear infinite;
        }

        .status-led:not(.connected):not(.connecting)::after {
            content: '‚úó';
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulse-success {
            0%, 100% { 
                box-shadow: 
                    var(--glow-green),
                    0 0 15px rgba(0, 255, 0, 0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 
                    0 0 30px var(--neon-green), 
                    0 0 60px var(--neon-green),
                    0 0 25px rgba(0, 255, 0, 0.6);
                transform: scale(1.05);
            }
        }

        @keyframes pulse-error {
            0%, 100% { 
                box-shadow: 
                    0 0 10px rgba(255, 0, 64, 0.4),
                    0 0 20px rgba(255, 0, 64, 0.2);
                transform: scale(1);
            }
            50% { 
                box-shadow: 
                    0 0 20px var(--error), 
                    0 0 40px var(--error),
                    0 0 30px rgba(255, 0, 64, 0.4);
                transform: scale(1.05);
            }
        }

        @keyframes pulse-warning {
            0%, 100% { 
                box-shadow: 
                    0 0 10px rgba(255, 255, 0, 0.4),
                    0 0 20px rgba(255, 255, 0, 0.2);
                transform: scale(1);
            }
            50% { 
                box-shadow: 
                    0 0 20px var(--warning), 
                    0 0 40px var(--warning),
                    0 0 30px rgba(255, 255, 0, 0.4);
                transform: scale(1.05);
            }
        }

        /* Enhanced Panel Headers */
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--glass-border);
        }

        .panel-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--neon-blue);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Configuration Panel Improvements */
        .config-panel {
            grid-area: config;
        }

        .config-section {
            margin-bottom: var(--space-lg);
        }

        .config-label {
            display: block;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: var(--space-sm);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .config-value {
            font-size: 1rem;
            color: var(--text-dim);
            margin-top: var(--space-sm);
            font-family: 'Share Tech Mono', monospace;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            max-width: 100%;
        }

        .config-value.file-info {
            background: var(--bg-black);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--glass-border);
        }

        .file-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .file-details {
            flex: 1;
            min-width: 0; /* Allow text to truncate */
        }

        .file-name {
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .file-size {
            font-size: 0.875rem;
            color: var(--text-dim);
            margin-top: 2px;
        }

        /* Enhanced Input Fields */
        .config-input {
            width: 100%;
            padding: var(--space-md) var(--space-lg);
            background: var(--bg-black);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: 'Share Tech Mono', monospace;
            font-size: 1rem;
            transition: var(--transition);
            position: relative;
        }

        .config-input:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: var(--glow-blue);
            background: rgba(0, 255, 255, 0.05);
        }

        .config-input.error {
            border-color: var(--error);
            box-shadow: 0 0 20px rgba(255, 0, 64, 0.3);
            animation: input-shake 0.5s ease-in-out;
        }

        @keyframes input-shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Enhanced File Drop Zone with Better Visual Feedback */
        .file-drop-zone {
            position: relative;
            margin-bottom: var(--space-lg);
            border: 2px dashed var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            background: var(--bg-glass);
            box-shadow: 
                inset 0 2px 6px rgba(0, 0, 0, 0.2),
                0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .file-drop-zone:hover,
        .file-drop-zone.drag-over {
            border-color: var(--neon-blue);
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 
                var(--glow-blue),
                inset 0 2px 6px rgba(0, 255, 255, 0.1),
                0 4px 16px rgba(0, 255, 255, 0.2);
            transform: scale(1.02);
        }

        .file-drop-zone.drag-over::before {
            content: 'üìÅ Drop file here!';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.25rem;
            color: var(--neon-blue);
            font-weight: bold;
            z-index: 10;
            text-shadow: var(--glow-blue);
            animation: pulse-glow 1s ease-in-out infinite alternate;
        }

        @keyframes pulse-glow {
            0% { opacity: 0.8; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-md);
            padding: var(--space-lg);
            background: linear-gradient(45deg, var(--neon-purple), var(--neon-blue));
            border: none;
            border-radius: var(--radius-md);
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .file-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--glow-purple);
            filter: brightness(1.2);
        }

        .file-button:focus {
            outline: 2px solid var(--neon-blue);
            outline-offset: 2px;
        }

        /* Main Panel Improvements */
        .main-panel {
            grid-area: main;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .phase-display {
            margin-bottom: var(--space-xl);
            font-size: 1.375rem;
            font-weight: 700;
            text-align: center;
        }

        /* Enhanced Progress Ring with Better Proportions */
        .progress-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin-bottom: var(--space-2xl);
        }

        /* Enhanced Progress Ring with Dynamic Glow */
        .progress-ring {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
            filter: drop-shadow(var(--glow-blue));
            transition: filter 0.3s ease;
        }

        .progress-ring.active {
            filter: drop-shadow(0 0 20px var(--neon-blue)) drop-shadow(0 0 40px var(--neon-blue));
        }

        .progress-fill {
            fill: none;
            stroke: url(#progressGradient);
            stroke-width: 20;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-percentage {
            font-size: 2.75rem;
            font-weight: 900;
            color: var(--neon-blue);
            margin-bottom: var(--space-sm);
            text-shadow: var(--glow-blue);
        }

        .progress-label {
            font-size: 1rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Enhanced Control Panel */
        .control-panel {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-2xl);
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Unified Cyberpunk Button System - Enhanced */
        .cyber-btn {
            padding: var(--space-md) var(--space-lg);
            border: 2px solid;
            background: transparent;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
            font-family: 'Orbitron', monospace;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            min-height: 44px; /* Better touch targets */
        }

        .cyber-btn:focus {
            outline: 2px solid var(--neon-blue);
            outline-offset: 2px;
        }

        .cyber-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .cyber-btn.primary {
            border-color: var(--neon-blue);
            color: var(--neon-blue);
        }

        .cyber-btn.primary:hover:not(:disabled) {
            background: var(--neon-blue);
            color: var(--bg-black);
            box-shadow: var(--glow-blue);
            transform: translateY(-2px);
        }

        .cyber-btn.success {
            border-color: var(--neon-green);
            color: var(--neon-green);
        }

        .cyber-btn.success:hover:not(:disabled) {
            background: var(--neon-green);
            color: var(--bg-black);
            box-shadow: var(--glow-green);
            transform: translateY(-2px);
        }

        .cyber-btn.danger {
            border-color: var(--error);
            color: var(--error);
        }

        .cyber-btn.danger:hover:not(:disabled) {
            background: var(--error);
            color: var(--bg-black);
            box-shadow: 0 0 20px rgba(255, 0, 64, 0.6);
            transform: translateY(-2px);
        }

        .cyber-btn.secondary {
            border-color: var(--neon-purple);
            color: var(--neon-purple);
        }

        .cyber-btn.secondary:hover:not(:disabled) {
            background: var(--neon-purple);
            color: var(--bg-black);
            box-shadow: var(--glow-purple);
            transform: translateY(-2px);
        }

        /* Large Control Buttons */
        .cyber-btn.large {
            padding: var(--space-lg) var(--space-xl);
            font-size: 1rem;
            min-width: 160px;
        }

        .cyber-btn.large:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
        }

        /* Small compact buttons */
        .cyber-btn.small {
            padding: var(--space-sm) var(--space-md);
            font-size: 0.625rem;
            min-width: auto;
        }

        .cyber-btn.control {
            /* Extend cyber-btn for control buttons - Enhanced with better accessibility */
        }

        /* File preview container */
        .file-preview-container {
            background: var(--bg-black);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            transition: var(--transition);
        }

        .file-preview-container:hover {
            border-color: var(--glass-border-active);
        }

        .file-icon-large {
            font-size: 2rem;
            opacity: 0.7;
        }

        .btn-group {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
            margin-top: var(--space-lg);
        }

        /* Enhanced Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-md);
            width: 100%;
            max-width: 600px;
        }

        .stat-card {
            background: var(--bg-black);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 3px 8px rgba(0, 0, 0, 0.3),
                0 1px 4px rgba(0, 255, 255, 0.1);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .stat-card:hover {
            border-color: var(--neon-blue);
            box-shadow: 
                0 6px 16px rgba(0, 0, 0, 0.4),
                0 2px 8px rgba(0, 255, 255, 0.2),
                var(--glow-blue);
            transform: translateY(-8px) scale(1.02);
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-value {
            font-size: 1.375rem;
            font-weight: 700;
            color: var(--neon-blue);
            margin-bottom: var(--space-sm);
            font-family: 'Share Tech Mono', monospace;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Status Panel Improvements */
        .status-panel {
            grid-area: status;
        }

        .log-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            background: var(--bg-black);
        }

        /* Enhanced Security Badges */
        .security-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-sm);
            margin-top: var(--space-lg);
        }

        .security-badge {
            padding: var(--space-lg);
            background: var(--bg-black);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            transition: var(--transition);
            position: relative;
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .security-badge.active {
            border-color: var(--success);
            box-shadow: inset 0 0 20px rgba(0, 255, 0, 0.2);
            background: rgba(0, 255, 0, 0.05);
            animation: security-activation 0.6s ease-out;
        }

        @keyframes security-activation {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .security-badge.active .badge-icon {
            color: var(--success);
            animation: security-pulse 2s infinite;
            filter: drop-shadow(var(--glow-green));
        }

        @keyframes security-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .badge-icon {
            font-size: 1.25rem;
        }

        .badge-text {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Theme Selector Improvements */
        .theme-selector {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            align-items: center;
            margin-top: var(--space-lg);
        }

        .theme-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            border: 3px solid var(--glass-border);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            outline: none;
        }

        .theme-btn:focus {
            outline: 2px solid var(--neon-blue);
            outline-offset: 3px;
        }

        .theme-btn.cyberpunk {
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue), var(--neon-purple));
        }

        .theme-btn.dark {
            background: linear-gradient(45deg, #2C3E50, #34495E, #1A1A1A);
        }

        .theme-btn.matrix {
            background: linear-gradient(45deg, #000000, var(--neon-green), #003300);
        }

        .theme-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 0 25px currentColor;
            border-color: var(--neon-blue);
        }

        .theme-btn.active {
            border-color: var(--neon-blue);
            box-shadow: var(--glow-blue);
            transform: scale(1.1);
        }

        .theme-btn.active::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 1rem;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
        }

        /* Enhanced Log System */
        .log-entry {
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-family: 'Share Tech Mono', monospace;
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            transition: var(--transition);
            cursor: pointer;
            border-left: 3px solid transparent;
            position: relative;
        }

        .log-entry:hover {
            background: var(--bg-medium);
            border-left-color: var(--neon-blue);
            transform: translateX(5px);
        }

        .log-entry:focus {
            outline: 2px solid var(--neon-blue);
            outline-offset: 2px;
        }

        .log-timestamp {
            font-size: 0.75rem;
            color: var(--text-dim);
            min-width: 60px;
        }

        .log-icon {
            font-size: 0.875rem;
            min-width: 16px;
        }

        .log-icon.success {
            color: var(--success);
        }

        .log-icon.error {
            color: var(--error);
        }

        .log-icon.info {
            color: var(--info);
        }

        .log-content {
            flex: 1;
        }

        .log-message {
            font-weight: 600;
            margin-bottom: var(--space-xs);
        }

        .log-details {
            font-size: 0.75rem;
            color: var(--text-dim);
            opacity: 0.8;
        }

        /* Enhanced Toast System with Better Stacking */
        .toast-container {
            position: fixed;
            top: var(--space-lg);
            right: var(--space-lg);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            max-width: 400px;
        }

        .toast {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: var(--space-lg) var(--space-xl);
            animation: toast-slide-in 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.5),
                0 2px 6px rgba(0, 0, 0, 0.3);
            min-width: 300px;
        }

        .toast.success {
            border-left: 4px solid var(--success);
            box-shadow: var(--glow-green);
        }

        .toast.error {
            border-left: 4px solid var(--error);
            box-shadow: 0 0 20px rgba(255, 0, 64, 0.3);
        }

        .toast.info {
            border-left: 4px solid var(--info);
            box-shadow: var(--glow-blue);
        }

        @keyframes toast-slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes toast-slide-out {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .toast-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: var(--space-md);
        }

        .toast-message {
            flex: 1;
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            flex-shrink: 0;
        }

        .toast-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* Enhanced Custom Modal System */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
            animation: modal-fade-in 0.3s ease-out;
        }

        @keyframes modal-fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: var(--bg-card);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            max-width: 500px;
            width: 90%;
            position: relative;
            animation: modal-slide-up 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
        }

        @keyframes modal-slide-up {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--neon-blue);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: var(--space-sm);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--neon-red);
            background: rgba(255, 0, 64, 0.1);
        }

        .confirm-modal .modal {
            max-width: 400px;
        }

        .confirm-modal .modal-title {
            color: var(--neon-yellow);
            margin-bottom: var(--space-lg);
        }

        .confirm-modal .modal-message {
            color: var(--text-secondary);
            margin-bottom: var(--space-xl);
            line-height: 1.5;
        }

        .confirm-modal .modal-buttons {
            display: flex;
            gap: var(--space-lg);
            justify-content: flex-end;
        }

        /* Debug Panel Improvements */
        .debug-panel {
            grid-area: debug;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            margin-bottom: var(--space-lg); /* Ensure spacing from bottom */
        }

        .debug-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .debug-content.show {
            max-height: 500px;
        }

        .debug-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .debug-section h3 {
            color: var(--neon-purple);
            margin-bottom: var(--space-md);
            font-size: 1.125rem;
        }

        .json-viewer {
            background: var(--bg-black);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        /* Enhanced Mobile Responsiveness */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "main"
                    "config"
                    "status"
                    "debug";
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .debug-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: var(--space-md) var(--space-md) var(--space-2xl); /* Extra bottom padding on mobile */
                gap: var(--space-md);
            }

            .header {
                padding: var(--space-lg);
                flex-direction: column;
                gap: var(--space-md);
            }

            .logo-icon {
                font-size: 2rem;
            }

            .logo-text h1 {
                font-size: 1.75rem;
            }

            .progress-container {
                width: 250px;
                height: 250px;
            }

            .progress-percentage {
                font-size: 2.25rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .control-panel {
                flex-direction: column;
                align-items: center;
            }

            .cyber-btn.large {
                width: 100%;
                max-width: 250px;
            }

            .security-grid {
                grid-template-columns: 1fr;
            }

            .theme-selector {
                gap: var(--space-md);
            }

            .btn-group {
                flex-direction: column;
            }

            .toast-container {
                top: var(--space-md);
                right: var(--space-md);
                left: var(--space-md);
                max-width: none;
            }

            .toast {
                min-width: auto;
                width: 100%;
            }

            .debug-panel {
                margin-bottom: var(--space-2xl);
            }
        }

        /* Loading States */
        .loading {
            display: inline-block;
            animation: loading-pulse 1.5s infinite;
        }

        @keyframes loading-pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .loading-spinner {
            display: inline-block;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid var(--glass-border);
            border-radius: 50%;
            border-top-color: var(--neon-blue);
            animation: spin 1s ease-in-out infinite;
        }

        /* Accessibility Improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        [aria-live] {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        /* Focus management */
        *:focus {
            outline: 2px solid var(--neon-blue);
            outline-offset: 2px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --glass-border: rgba(255, 255, 255, 0.8);
                --text-secondary: #FFFFFF;
                --text-dim: #CCCCCC;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="cyber-grid"></div>
    <div class="particle-container" id="particleContainer"></div>
    <div class="toast-container" id="toastContainer" role="status" aria-live="polite"></div>
    <div aria-live="polite" aria-atomic="true" class="sr-only" id="announcements"></div>
    
    <div class="container">
        <!-- Header -->
        <header class="header" role="banner">
            <div class="logo">
                <div class="logo-icon neon-text pink" tabindex="0" role="button" aria-label="CyberBackup Logo">‚ö°</div>
                <div class="logo-text">
                    <h1 class="neon-text pink">CYBERBACKUP PRO</h1>
                    <div class="subtitle">v3.0 (API Driven)</div>
                </div>
            </div>
            <div class="connection-status">
                <div class="status-led" id="connectionLed" aria-label="Connection status"></div>
                <span id="connectionText" style="font-weight: 600;">OFFLINE</span>
            </div>
        </header>

        <!-- Configuration Panel -->
        <aside class="config-panel glass-card" role="region" aria-label="Configuration">
            <div class="panel-header">
                <h2 class="panel-title">System Configuration</h2>
            </div>
            
            <div class="config-section">                <label class="config-label" for="serverInput">Server Address</label>
                <input type="text" class="config-input" id="serverInput" 
                       placeholder="127.0.0.1:1256" value="127.0.0.1:1256" aria-describedby="serverHelp">
                <div id="serverHelp" class="sr-only">Enter server IP address and port</div>
            </div>
            
            <div class="config-section">
                <label class="config-label" for="usernameInput">Username</label>
                <input type="text" class="config-input" id="usernameInput" 
                       placeholder="Enter username" value="testuser" maxlength="100" aria-describedby="usernameHelp">
                <div id="usernameHelp" class="sr-only">Username for authentication (max 100 characters)</div>
            </div>
            
            <div class="config-section">
                <label class="config-label">Target File</label>
                <div class="file-drop-zone" id="fileDropZone">
                    <input type="file" class="file-input" id="fileInput" 
                           aria-describedby="fileHelp" accept="*/*" 
                           title="Select a file to backup" 
                           aria-label="File selection for backup">
                    <div class="file-button">
                        üìÅ Select File to Backup
                        <span class="sr-only">or drag and drop a file here</span>
                    </div>
                </div>
                <div id="fileHelp" class="sr-only">Select a file for backup or drag and drop</div>
                <div class="config-value" id="selectedFile">No file selected</div>
                <div id="filePreview" class="file-preview-container" style="margin-top: var(--space-md); text-align: center; min-height: 60px; display: flex; align-items: center; justify-content: center;"></div>
            </div>
            
            <div class="config-section">
                <label class="config-label">Client ID</label>
                <div class="config-value" id="clientId">Not connected</div>
            </div>

            <div class="btn-group">
                <button class="cyber-btn success" data-action="save-config">üíæ Save Config</button>
            </div>

            <div class="panel-header" style="margin-top: var(--space-xl);">
                <h2 class="panel-title">Theme Selection</h2>
            </div>
            
            <div class="theme-selector">
                <button class="theme-btn cyberpunk active" 
                        aria-label="Cyberpunk theme" title="Cyberpunk Theme"></button>
                <button class="theme-btn dark" 
                        aria-label="Dark theme" title="Dark Theme"></button>
                <button class="theme-btn matrix" 
                        aria-label="Matrix theme" title="Matrix Theme"></button>
            </div>
        </aside>

        <!-- Main Panel -->
        <main class="main-panel glass-card" role="main">
            <div class="phase-display" id="currentPhase">
                <span class="neon-text purple">SYSTEM READY</span>
            </div>
            
            <div class="progress-container">
                <svg class="progress-ring" viewBox="0 0 300 300" role="img" aria-label="Transfer progress">
                    <defs>
                        <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:var(--neon-blue);stop-opacity:1" />
                            <stop offset="33%" style="stop-color:var(--neon-purple);stop-opacity:1" />
                            <stop offset="66%" style="stop-color:var(--neon-pink);stop-opacity:1" />
                            <stop offset="100%" style="stop-color:var(--neon-green);stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle class="progress-bg" cx="150" cy="150" r="130" 
                            fill="none" stroke="var(--bg-light)" stroke-width="16"></circle>
                    <circle class="progress-fill" cx="150" cy="150" r="130" id="progressCircle"></circle>
                </svg>
                <div class="progress-text">
                    <div class="progress-percentage neon-text" id="progressPercentage">0%</div>
                    <div class="progress-label" id="progressStatus">READY</div>
                </div>
            </div>            <div class="control-panel">
                <button type="button" class="cyber-btn primary large control-btn" id="primaryAction">
                    <span class="btn-icon">üöÄ</span>
                    <span class="btn-text">CONNECT</span>
                </button>
                <button type="button" class="cyber-btn secondary large control-btn" id="pauseBtn" disabled>
                    <span class="btn-icon">‚è∏Ô∏è</span>
                    <span class="btn-text">PAUSE</span>
                </button>
                <button type="button" class="cyber-btn danger large control-btn" id="stopBtn" disabled>
                    <span class="btn-icon">üõë</span>
                    <span class="btn-text">STOP</span>
                </button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="speedStat">0 B/s</div>
                    <div class="stat-label">Transfer Speed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="etaStat">--:--</div>
                    <div class="stat-label">ETA</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="transferredStat">0 B</div>
                    <div class="stat-label">Transferred</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sizeStat">0 B</div>
                    <div class="stat-label">Total Size</div>
                </div>
            </div>
        </main>

        <!-- Status Panel -->
        <aside class="status-panel glass-card" role="region" aria-label="Operation log">
            <div class="panel-header">
                <h2 class="panel-title">Operation Log</h2>
                <div class="btn-group">
                    <button class="cyber-btn success small" data-action="export-log">üì• Export</button>
                    <button class="cyber-btn danger small" data-action="clear-log">üóëÔ∏è Clear</button>
                    <button type="button" class="cyber-btn primary small" id="autoScrollBtn">
                        üìú Auto-scroll: ON
                    </button>
                </div>
            </div>
            
            <div class="log-container" id="logContainer" role="log" aria-live="polite" aria-label="Activity log">
                <!-- Logs will be populated here -->
            </div>
        </aside>

        <!-- Debug Panel -->
        <div class="debug-panel glass-card" role="region" aria-label="Developer console">
            <div class="panel-header">
                <h2 class="panel-title">Developer Console</h2>
                <button type="button" class="cyber-btn primary small" id="debugToggle" 
                        aria-expanded="false">üîß Toggle Debug</button>
            </div>
            
            <div class="debug-content" id="debugContent">
                <div class="debug-grid">
                    <div class="debug-section">
                        <h3>üìä Last API Response</h3>
                        <div class="json-viewer" id="statusJsonViewer">Waiting for status data...</div>
                    </div>
                    <div class="debug-section">
                        <h3>üìà State Machine</h3>
                        <div class="json-viewer" id="progressJsonViewer">Waiting for state data...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Custom Confirmation Modal -->
    <div class="modal-overlay confirm-modal" id="confirmModal">
        <div class="modal">
            <h3 class="modal-title" id="confirmTitle">Confirm Action</h3>
            <p class="modal-message" id="confirmMessage">Are you sure?</p>
            <div class="modal-buttons">
                <button class="cyber-btn secondary" data-action="cancel-modal">Cancel</button>
                <button type="button" class="cyber-btn danger" id="confirmOkBtn">Confirm</button>
            </div>
        </div>
    </div>    <script>
        // === IMMEDIATE TEST ===
        alert('JavaScript is working! Script started loading...');
        console.log('JavaScript is working! Script started loading...');
        
        // === ENHANCED DEBUG LOGGING SYSTEM ===
        class DebugLogger {
            constructor() {
                this.levels = {
                    ERROR: { value: 0, color: '#ff0040', prefix: 'ERROR' },
                    WARN: { value: 1, color: '#ffff00', prefix: 'WARN' },
                    INFO: { value: 2, color: '#00ffff', prefix: 'INFO' },
                    DEBUG: { value: 3, color: '#00ff00', prefix: 'DEBUG' },
                    TRACE: { value: 4, color: '#888888', prefix: 'TRACE' }
                };
                
                this.currentLevel = this.levels.DEBUG; // Default level
                this.filters = new Set(); // Category filters
                this.debugDiv = null;
                this.isEnabled = true;
                this.maxEntries = 1000; // Prevent memory issues
                this.entries = [];
                
                // Load preferences from localStorage
                this.loadPreferences();
                
                // Setup keyboard shortcut for debug toggle
                this.setupKeyboardShortcuts();
            }

            setLevel(levelName) {
                if (this.levels[levelName]) {
                    this.currentLevel = this.levels[levelName];
                    this.savePreferences();
                    this.log('DEBUG', 'DEBUG', `Debug level set to ${levelName}`);
                }
            }

            addFilter(category) {
                this.filters.add(category.toUpperCase());
                this.savePreferences();
            }

            removeFilter(category) {
                this.filters.delete(category.toUpperCase());
                this.savePreferences();
            }

            clearFilters() {
                this.filters.clear();
                this.savePreferences();
            }

            toggle() {
                this.isEnabled = !this.isEnabled;
                if (this.debugDiv) {
                    this.debugDiv.style.display = this.isEnabled ? 'block' : 'none';
                }
                this.savePreferences();
            }

            log(level, category, message) {
                const levelObj = this.levels[level];
                if (!levelObj || !this.isEnabled) return;
                
                // Check level filtering
                if (levelObj.value > this.currentLevel.value) return;
                
                // Check category filtering
                if (this.filters.size > 0 && !this.filters.has(category.toUpperCase())) return;

                const timestamp = new Date().toLocaleTimeString();
                const entry = { timestamp, level, category, message, levelObj };
                
                // Add to entries array
                this.entries.push(entry);
                if (this.entries.length > this.maxEntries) {
                    this.entries.shift(); // Remove oldest entry
                }

                // Console logging
                const consoleMessage = `[${levelObj.prefix}] [${category}] ${message}`;
                switch (level) {
                    case 'ERROR': console.error(consoleMessage); break;
                    case 'WARN': console.warn(consoleMessage); break;
                    case 'INFO': console.info(consoleMessage); break;
                    default: console.log(consoleMessage); break;
                }

                // Visual debug div
                this.updateDebugDiv(entry);
            }

            updateDebugDiv(entry) {
                if (!this.debugDiv) {
                    this.debugDiv = this.createDebugDiv();
                }

                const entryDiv = document.createElement('div');
                entryDiv.style.cssText = `color: ${entry.levelObj.color}; margin-bottom: 2px; font-size: 11px; line-height: 1.2;`;
                entryDiv.innerHTML = `<span style="color: #666;">[${entry.timestamp}]</span> <span style="color: ${entry.levelObj.color}; font-weight: bold;">[${entry.levelObj.prefix}]</span> <span style="color: #ccc;">[${entry.category}]</span> ${entry.message}`;
                
                this.debugDiv.appendChild(entryDiv);
                
                // Auto-scroll to bottom
                this.debugDiv.scrollTop = this.debugDiv.scrollHeight;
                
                // Limit entries in DOM
                if (this.debugDiv.children.length > 200) {
                    this.debugDiv.removeChild(this.debugDiv.firstChild);
                }
            }

            createDebugDiv() {
                const div = document.createElement('div');
                div.id = 'debug-output';
                div.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    width: 450px;
                    height: 300px;
                    background: rgba(0, 0, 0, 0.95);
                    color: #00ff00;
                    padding: 10px;
                    border: 2px solid #00ffff;
                    border-radius: 8px;
                    overflow-y: auto;
                    z-index: 9999;
                    font-family: 'Courier New', monospace;
                    font-size: 12px;
                    -webkit-backdrop-filter: blur(10px);
                    backdrop-filter: blur(10px);
                    display: ${this.isEnabled ? 'block' : 'none'};
                `;
                
                // Add header with controls
                const header = document.createElement('div');
                header.style.cssText = 'position: sticky; top: 0; background: rgba(0, 0, 0, 0.9); padding: 5px 0; border-bottom: 1px solid #00ffff; margin-bottom: 5px;';
                header.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #00ffff; font-weight: bold;">Debug Console</span>
                        <div>
                            <button onclick="debugLogger.clearEntries()" style="background: none; border: 1px solid #00ffff; color: #00ffff; padding: 2px 6px; font-size: 10px; cursor: pointer;">Clear</button>
                            <button onclick="debugLogger.toggle()" style="background: none; border: 1px solid #ff0040; color: #ff0040; padding: 2px 6px; font-size: 10px; cursor: pointer;">√ó</button>
                        </div>
                    </div>
                `;
                
                div.appendChild(header);
                document.body.appendChild(div);
                return div;
            }

            clearEntries() {
                this.entries = [];
                if (this.debugDiv) {
                    // Keep only the header
                    const header = this.debugDiv.firstChild;
                    this.debugDiv.innerHTML = '';
                    this.debugDiv.appendChild(header);
                }
            }

            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl+Shift+D toggles debug console
                    if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                        e.preventDefault();
                        this.toggle();
                    }
                });
            }

            savePreferences() {
                const prefs = {
                    level: Object.keys(this.levels).find(key => this.levels[key] === this.currentLevel),
                    filters: Array.from(this.filters),
                    enabled: this.isEnabled
                };
                localStorage.setItem('cyberbackup_debug_prefs', JSON.stringify(prefs));
            }

            loadPreferences() {
                try {
                    const saved = localStorage.getItem('cyberbackup_debug_prefs');
                    if (saved) {
                        const prefs = JSON.parse(saved);
                        if (prefs.level && this.levels[prefs.level]) {
                            this.currentLevel = this.levels[prefs.level];
                        }
                        if (prefs.filters) {
                            this.filters = new Set(prefs.filters);
                        }
                        if (typeof prefs.enabled === 'boolean') {
                            this.isEnabled = prefs.enabled;
                        }
                    }
                } catch (error) {
                    console.warn('Failed to load debug preferences:', error);
                }
            }

            getStatus() {
                return {
                    level: Object.keys(this.levels).find(key => this.levels[key] === this.currentLevel),
                    filters: Array.from(this.filters),
                    enabled: this.isEnabled,
                    entryCount: this.entries.length
                };
            }
        }

        // Create global debug logger instance
        const debugLogger = new DebugLogger();

        // Backward compatibility function
        function debugLog(message, category = 'GENERAL') {
            debugLogger.log('DEBUG', category, message);
        }

        debugLog('=== SCRIPT LOADING STARTED ===');

        /**
         * =================================================================
         * API-DRIVEN CLIENT GUI v3.0
         * =================================================================
         * This version has been refactored to communicate with a local
         * C++ web server (via Boost.Beast) instead of a file-based system.
         * The GUI now acts as a true frontend to the C++ backend.
         * =================================================================
         */

        // Interval Manager to prevent leaks
        debugLog('Defining IntervalManager class...');
        class IntervalManager {
            constructor() {
                this.intervals = new Map();
            }
            set(name, callback, delay) {
                this.clear(name);
                this.intervals.set(name, setInterval(callback, delay));
            }
            clear(name) {
                if (this.intervals.has(name)) {
                    clearInterval(this.intervals.get(name));
                    this.intervals.delete(name);
                }
            }
            clearAll() {
                this.intervals.forEach(id => clearInterval(id));
                this.intervals.clear();
            }        }
        debugLog('IntervalManager class defined successfully');

        /**
         * NEW: ApiClient
         * Handles all communication with the local C++ web server.
         */
        debugLog('Defining ApiClient class...');
        class ApiClient {
            constructor(baseUrl = 'http://127.0.0.1:9090') {
                this.baseUrl = baseUrl;
            }

            async getStatus() {
                debugLog('Fetching status...', 'API');
                const response = await fetch(`${this.baseUrl}/api/status`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                debugLog('Status response:' + JSON.stringify(data), 'API');
                return data;
            }

            async connect(config) {
                debugLog('Connecting to server...' + JSON.stringify(config), 'API');
                const response = await fetch(`${this.baseUrl}/api/connect`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(config),
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                debugLog('Connect response:' + JSON.stringify(data), 'API');
                return data;
            }

            async startBackup(file, config) {
                debugLog('Starting backup...', 'API');
                const formData = new FormData();
                formData.append('file', file);
                formData.append('username', config.username);
                formData.append('server', config.serverIP);
                formData.append('port', config.serverPort);

                const response = await fetch(`${this.baseUrl}/api/start_backup`, {
                    method: 'POST',
                    body: formData,
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                debugLog('Start backup response:' + JSON.stringify(data), 'API');
                return data;
            }

            async stopBackup() {
                debugLog('Stopping backup...', 'API');
                const response = await fetch(`${this.baseUrl}/api/stop`, { method: 'POST' });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                debugLog('Stop backup response:' + JSON.stringify(data), 'API');
                return data;
            }

            async pauseBackup() {
                debugLog('Pausing backup...', 'API');
                const response = await fetch(`${this.baseUrl}/api/pause`, { method: 'POST' });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                debugLog('Pause backup response:' + JSON.stringify(data), 'API');
                return data;
            }

            async resumeBackup() {
                debugLog('Resuming backup...', 'API');
                const response = await fetch(`${this.baseUrl}/api/resume`, { method: 'POST' });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                debugLog('Resume backup response:' + JSON.stringify(data), 'API');
                return data;
            }

            async getServerInfo() {
                debugLog('Fetching server info...', 'API');
                const response = await fetch(`${this.baseUrl}/api/server_info`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                debugLog('Server info response:' + JSON.stringify(data), 'API');
                return data;
            }

            async getReceivedFiles() {
                debugLog('Fetching received files...', 'API');
                const response = await fetch(`${this.baseUrl}/api/received_files`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                debugLog('Received files response:' + JSON.stringify(data), 'API');
                return data;
            }
        }
        debugLog('ApiClient class defined successfully');

        /**
         * NEW: FileManager
         * Handles file selection (modern File System Access API with fallback).
         */
        debugLog('Defining FileManager class...');
        class FileManager {
            constructor() {
                this.supportsFileSystemAccess = 'showOpenFilePicker' in window;
                debugLog(`File System Access API supported: ${this.supportsFileSystemAccess}`, 'FILE_MANAGER');
            }

            async selectFile() {
                // First try modern File System Access API
                if (this.supportsFileSystemAccess) {
                    try {
                        console.log('[FileManager] Attempting modern file picker...');
                        const [fileHandle] = await window.showOpenFilePicker({
                            types: [{
                                description: 'All files',
                                accept: {
                                    '*/*': ['.*']
                                }
                            }],
                            multiple: false
                        });
                        
                        const file = await fileHandle.getFile();
                        console.log('[FileManager] Modern file picker succeeded:', file.name);
                        return file;
                    } catch (error) {
                        if (error.name !== 'AbortError') {
                            console.warn('[FileManager] Modern file picker failed:', error);
                            console.log('[FileManager] Falling back to traditional input...');
                        } else {
                            console.log('[FileManager] User cancelled modern file picker');
                            return null;
                        }
                    }
                }
                
                // Fallback to traditional file input - improved version
                console.log('[FileManager] Using traditional file input fallback');
                return new Promise((resolve, reject) => {
                    try {
                        const input = document.createElement('input');
                        input.type = 'file';
                        input.accept = '*/*';
                        input.style.display = 'none';
                        
                        // Add to DOM for better browser compatibility
                        document.body.appendChild(input);
                        
                        // Set up event handlers
                        const cleanup = () => {
                            if (input.parentNode) {
                                input.parentNode.removeChild(input);
                            }
                        };
                        
                        input.onchange = (event) => {
                            const file = event.target.files[0] || null;
                            console.log('[FileManager] Traditional file picker result:', file ? file.name : 'No file selected');
                            cleanup();
                            resolve(file);
                        };
                        
                        input.oncancel = () => {
                            console.log('[FileManager] User cancelled traditional file picker');
                            cleanup();
                            resolve(null);
                        };
                        
                        // Handle case where user closes dialog without triggering change
                        const handleFocus = () => {
                            setTimeout(() => {
                                if (!input.files.length) {
                                    console.log('[FileManager] Focus returned, assuming dialog was cancelled');
                                    cleanup();
                                    resolve(null);
                                }
                                window.removeEventListener('focus', handleFocus);
                            }, 300);
                        };
                        
                        window.addEventListener('focus', handleFocus);
                        
                        // Trigger file dialog
                        input.click();
                        
                        // Safety timeout
                        setTimeout(() => {
                            if (input.parentNode) {
                                console.warn('[FileManager] File picker timeout, cleaning up');
                                cleanup();
                                resolve(null);
                            }
                        }, 30000);
                        
                    } catch (error) {
                        console.error('[FileManager] Fallback file picker error:', error);
                        reject(error);
                    }
                });
            }

            setupDragAndDrop(dropZone, onFileSelected) {
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('drag-over');
                });

                dropZone.addEventListener('dragleave', () => {
                    dropZone.classList.remove('drag-over');
                });

                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('drag-over');
                    if (e.dataTransfer.files.length > 0) {
                        onFileSelected(e.dataTransfer.files[0]);
                    }
                });

                // Handle click on the drop zone to trigger file input
                dropZone.addEventListener('click', () => {
                    const fileInput = dropZone.querySelector('.file-input');
                    if (fileInput) {
                        fileInput.click();
                    }
                });

                // Handle file input change directly
                const fileInput = dropZone.querySelector('.file-input');
                if (fileInput) {
                    fileInput.addEventListener('change', (e) => {
                        if (e.target.files.length > 0) {
                            onFileSelected(e.target.files[0]);
                        }
                    });
                }
            }
        }
        debugLog('FileManager class defined successfully');

        /**
         * NEW: SystemManager
         * Handles system-level interactions like notifications, modals, and keyboard shortcuts.
         */
        debugLog('Defining SystemManager class...');
        class SystemManager {
            constructor() {
                this.notifications = new NotificationManager();
                this.modal = new ModalManager();
                this.confirmModal = new ConfirmModalManager();
                this.fileManager = new FileManager();
            }

            setupKeyboardShortcuts(appInstance) {
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.modal.hide();
                        this.confirmModal.hide();
                    }
                    // Ctrl+S to save config
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        appInstance.saveConfig();
                    }
                    // Ctrl+B to start backup
                    if (e.ctrlKey && e.key === 'b') {
                        e.preventDefault();
                        appInstance.handlePrimaryAction();
                    }
                    // Ctrl+P to pause/resume
                    if (e.ctrlKey && e.key === 'p') {
                        e.preventDefault();
                        appInstance.togglePause();
                    }
                    // Ctrl+T to stop
                    if (e.ctrlKey && e.key === 't') {
                        e.preventDefault();
                        appInstance.stopBackup();
                    }
                });
            }
        }
        debugLog('SystemManager class defined successfully');

        /**
         * NEW: NotificationManager
         * Handles browser notifications.
         */
        debugLog('Defining NotificationManager class...');
        class NotificationManager {
            constructor() {
                if (!('Notification' in window)) {
                    debugLog('Browser does not support notifications.', 'NOTIFICATIONS');
                }
            }

            async requestPermission() {
                if (!('Notification' in window)) return;
                const permission = await Notification.requestPermission();
                debugLog(`Notification permission: ${permission}`, 'NOTIFICATIONS');
                return permission;
            }

            show(title, body, options = {}) {
                if (!('Notification' in window) || Notification.permission !== 'granted') {
                    debugLog('Notification permission not granted or not supported.', 'NOTIFICATIONS');
                    return;
                }
                const notification = new Notification(title, { body, ...options });
                debugLog(`Notification shown: ${title} - ${body}`, 'NOTIFICATIONS');
                return notification;
            }
        }
        debugLog('NotificationManager class defined successfully');

        /**
         * NEW: ModalManager
         * Handles generic modal dialogs.
         */
        debugLog('Defining ModalManager class...');
        class ModalManager {
            constructor() {
                this.modalOverlay = document.getElementById('confirmModal'); // Reusing for simplicity
                this.modalTitle = document.getElementById('confirmTitle');
                this.modalMessage = document.getElementById('confirmMessage');
                this.confirmOkBtn = document.getElementById('confirmOkBtn');
                this.cancelBtn = this.modalOverlay.querySelector('[data-action="cancel-modal"]');

                this.resolve = null;
                this.reject = null;

                this.cancelBtn.addEventListener('click', () => this.hide());
                this.modalOverlay.addEventListener('click', (e) => {
                    if (e.target === this.modalOverlay) {
                        this.hide();
                    }
                });
            }

            show(title, message, onConfirm) {
                this.modalTitle.textContent = title;
                this.modalMessage.textContent = message;
                this.confirmOkBtn.onclick = () => {
                    onConfirm();
                    this.hide();
                };
                this.modalOverlay.classList.add('show');
            }

            hide() {
                this.modalOverlay.classList.remove('show');
            }
        }
        debugLog('ModalManager class defined successfully');

        /**
         * NEW: ConfirmModalManager
         * Handles confirmation dialogs with Promises.
         */
        debugLog('Defining ConfirmModalManager class...');
        class ConfirmModalManager extends ModalManager {
            constructor() {
                super();
                this.confirmOkBtn.removeEventListener('click', this.confirmOkBtn.onclick); // Remove old listener
                this.confirmOkBtn.addEventListener('click', () => {
                    if (this.resolve) this.resolve(true);
                    this.hide();
                });
                this.cancelBtn.removeEventListener('click', this.cancelBtn.onclick); // Remove old listener
                this.cancelBtn.addEventListener('click', () => {
                    if (this.resolve) this.resolve(false);
                    this.hide();
                });
            }

            async confirm(title, message) {
                this.modalTitle.textContent = title;
                this.modalMessage.textContent = message;
                this.modalOverlay.classList.add('show');
                return new Promise((resolve, reject) => {
                    this.resolve = resolve;
                    this.reject = reject;
                });
            }
        }
        debugLog('ConfirmModalManager class defined successfully');

        /**
         * Main Application Logic (App class)
         */
        debugLog('Defining App class...');
        class App {
            constructor() {
                this.apiClient = new ApiClient();
                this.system = new SystemManager();
                this.intervals = new IntervalManager();

                this.elements = {
                    connectionLed: document.getElementById('connectionLed'),
                    connectionText: document.getElementById('connectionText'),
                    serverInput: document.getElementById('serverInput'),
                    usernameInput: document.getElementById('usernameInput'),
                    fileDropZone: document.getElementById('fileDropZone'),
                    fileInput: document.getElementById('fileInput'),
                    selectedFileDisplay: document.getElementById('selectedFile'),
                    filePreview: document.getElementById('filePreview'),
                    clientIdDisplay: document.getElementById('clientId'),
                    primaryActionButton: document.getElementById('primaryAction'),
                    pauseButton: document.getElementById('pauseBtn'),
                    stopButton: document.getElementById('stopBtn'),
                    currentPhaseDisplay: document.getElementById('currentPhase'),
                    progressCircle: document.getElementById('progressCircle'),
                    progressPercentage: document.getElementById('progressPercentage'),
                    progressStatus: document.getElementById('progressStatus'),
                    speedStat: document.getElementById('speedStat'),
                    etaStat: document.getElementById('etaStat'),
                    transferredStat: document.getElementById('transferredStat'),
                    sizeStat: document.getElementById('sizeStat'),
                    logContainer: document.getElementById('logContainer'),
                    autoScrollBtn: document.getElementById('autoScrollBtn'),
                    debugToggle: document.getElementById('debugToggle'),
                    debugContent: document.getElementById('debugContent'),
                    statusJsonViewer: document.getElementById('statusJsonViewer'),
                    progressJsonViewer: document.getElementById('progressJsonViewer'),
                    toastContainer: document.getElementById('toastContainer'),
                    confirmModal: document.getElementById('confirmModal'),
                    confirmTitle: document.getElementById('confirmTitle'),
                    confirmMessage: document.getElementById('confirmMessage'),
                    confirmOkBtn: document.getElementById('confirmOkBtn'),
                    cancelModalBtn: document.getElementById('cancelModalBtn')
                };

                this.state = {
                    isConnected: false,
                    isRunning: false,
                    isPaused: false,
                    phase: 'SYSTEM_READY',
                    progress: 0,
                    file_name: '',
                    file_size: 0,
                    transferred: 0,
                    speed: 0,
                    eta: '--:--',
                    clientId: null,
                    log: { operation: 'System Initialized', success: true, details: '' },
                    lastApiStatus: null,
                    selectedFile: null
                };

                // Enhanced state management for preventing race conditions and optimizing performance
                this.stateManagement = {
                    isPolling: false,
                    isUpdatingUI: false,
                    lastPollTime: 0,
                    pollCooldown: 500, // Minimum time between polls in ms
                    adaptivePollInterval: 1000, // Dynamic interval that adapts based on activity
                    maxPollInterval: 5000, // Maximum interval when idle
                    minPollInterval: 500, // Minimum interval when active
                    consecutiveNoChangeCount: 0, // Track periods of no activity
                    uiUpdateQueue: [],
                    updateUIDebounced: this.debounce(() => this._updateAllUI(), 150) // Slightly increased debounce
                };
                
                this.pendingConfirmAction = null;
                this.autoScrollLog = true;
                this.themeManager = new ThemeManager();

                this.initEventListeners();
                this.loadSavedConfig();
                this.themeManager.loadSavedTheme();
                this.system.setupKeyboardShortcuts(this); // Add keyboard shortcuts

                // Initialize lazy loading system for performance
                this.lazyComponents = new Map();
                this.initializeLazyLoading();

                // Start adaptive status polling with intelligent frequency adjustment
                this.startAdaptivePolling();
                this.addLog('System Initialized', 'success', 'Ready to connect to C++ client.');
                this.system.notifications.show('CyberBackup Pro', 'Application ready', { type: 'info', silent: true });
                
                // Request notification permission on startup
                this.system.notifications.requestPermission();
            }

            initEventListeners() {
                this.elements.primaryActionButton.addEventListener('click', () => this.handlePrimaryAction());
                this.elements.pauseButton.addEventListener('click', () => this.togglePause());
                this.elements.stopButton.addEventListener('click', () => this.stopBackup());
                
                // Config save button
                document.querySelector('[data-action="save-config"]').addEventListener('click', () => this.saveConfig());

                // File drop zone
                this.system.fileManager.setupDragAndDrop(
                    this.elements.fileDropZone,
                    (file) => this.handleFileSelection(file)
                );

                // Log controls
                document.querySelector('[data-action="export-log"]').addEventListener('click', () => this.exportLog());
                document.querySelector('[data-action="clear-log"]').addEventListener('click', () => this.clearLog());
                this.elements.autoScrollBtn.addEventListener('click', () => this.toggleAutoScroll());

                // Debug toggle
                this.elements.debugToggle.addEventListener('click', () => this.toggleDebugConsole());

                // Theme buttons
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const theme = e.target.classList[1]; // e.g., 'cyberpunk', 'dark', 'matrix'
                        this.themeManager.setTheme(theme);
                    });
                });

                // Modals
                this.elements.confirmOkBtn.addEventListener('click', () => {
                    if (this.pendingConfirmAction) {
                        this.pendingConfirmAction.resolve(true);
                        this.pendingConfirmAction = null;
                    }
                    this.system.confirmModal.hide();
                });
                this.elements.cancelModalBtn.addEventListener('click', () => {
                    if (this.pendingConfirmAction) {
                        this.pendingConfirmAction.resolve(false);
                        this.pendingConfirmAction = null;
                    }
                    this.system.confirmModal.hide();
                });
            }

            async pollStatus() {
                if (this.stateManagement.isPolling) {
                    debugLog('Skipping poll: already polling', 'POLL');
                    return;
                }

                const now = Date.now();
                if (now - this.stateManagement.lastPollTime < this.stateManagement.pollCooldown) {
                    debugLog('Skipping poll: cooldown active', 'POLL');
                    return;
                }

                this.stateManagement.isPolling = true;
                this.stateManagement.lastPollTime = now;

                try {
                    const status = await this.apiClient.getStatus();
                    debugLog('Raw API Status:' + JSON.stringify(status), 'POLL');

                    let stateChanged = false;

                    // Check for changes in connection status
                    if (this.state.isConnected !== status.isConnected) {
                        this.state.isConnected = status.isConnected;
                        stateChanged = true;
                    }

                    // Check for changes in running status
                    if (this.state.isRunning !== status.isRunning) {
                        this.state.isRunning = status.isRunning;
                        stateChanged = true;
                    }

                    // Check for changes in paused status
                    if (this.state.isPaused !== status.isPaused) {
                        this.state.isPaused = status.isPaused;
                        stateChanged = true;
                    }

                    // Check for changes in phase
                    if (this.state.phase !== status.phase) {
                        this.state.phase = status.phase;
                        stateChanged = true;
                    }

                    // Check for changes in progress percentage
                    if (this.state.progress !== status.progress.percentage) {
                        this.state.progress = status.progress.percentage;
                        stateChanged = true;
                    }

                    // Check for changes in log message (operation)
                    if (this.state.log.operation !== status.log.operation) {
                        this.state.log.operation = status.log.operation;
                        stateChanged = true;
                    }

                    // Adaptive polling frequency adjustment
                    if (stateChanged) {
                        this.stateManagement.consecutiveNoChangeCount = 0;
                        // Faster polling when there are changes
                        this.stateManagement.adaptivePollInterval = Math.max(
                            this.stateManagement.minPollInterval,
                            this.stateManagement.adaptivePollInterval * 0.8
                        );
                    } else {
                        this.stateManagement.consecutiveNoChangeCount++;
                        // Slower polling when no changes
                        if (this.stateManagement.consecutiveNoChangeCount >= 3) {
                            this.stateManagement.adaptivePollInterval = Math.min(
                                this.stateManagement.maxPollInterval,
                                this.stateManagement.adaptivePollInterval * 1.2
                            );
                        }
                    }

                    debugLog('POLL: State updated - connected: ' + this.state.isConnected + ', changed: ' + stateChanged + ', nextInterval: ' + this.stateManagement.adaptivePollInterval + 'ms');

                    // Handle additional data
                    if (status.progress) this.updateProgress(status.progress);
                    if (status.clientId) this.state.clientId = status.clientId;
                    if (status.log) this.addLog(status.log.operation, status.log.success ? 'info' : 'error', status.log.details);

                    this.state.lastApiStatus = status; // Store raw status for debug
                    this.updateAllUI();

                } catch (error) {
                    console.error('Error polling status:', error);
                    debugLog('Error polling status: ' + error.message, 'ERROR');
                    this.state.isConnected = false;
                    this.state.isRunning = false;
                    this.state.isPaused = false;
                    this.state.phase = 'ERROR';
                    this.state.log = { operation: 'API Error', success: false, details: error.message };
                    this.updateAllUI();
                } finally {
                    this.stateManagement.isPolling = false;
                }
            }

            // Lazy loading system for performance optimization
            initializeLazyLoading() {
                // Mark components for lazy initialization
                this.lazyComponents.set('debugConsole', {
                    initialized: false,
                    element: '#debugContent',
                    initFunction: () => this.initializeDebugConsole()
                });
                
                this.lazyComponents.set('advancedSettings', {
                    initialized: false,
                    element: '.advanced-settings',
                    initFunction: () => this.initializeAdvancedSettings()
                });

                // Set up intersection observer for components that become visible
                if ('IntersectionObserver' in window) {
                    this.setupLazyLoadObserver();
                }
                
                console.log('[LazyLoad] Lazy loading system initialized for', this.lazyComponents.size, 'components');
            }

            setupLazyLoadObserver() {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const componentId = entry.target.getAttribute('data-lazy-component');
                            if (componentId && this.lazyComponents.has(componentId)) {
                                this.loadLazyComponent(componentId);
                            }
                        }
                    });
                }, { threshold: 0.1 });

                // Observe elements marked for lazy loading
                document.querySelectorAll('[data-lazy-component]').forEach(el => {
                    observer.observe(el);
                });
            }

            loadLazyComponent(componentId) {
                const component = this.lazyComponents.get(componentId);
                if (component && !component.initialized) {
                    console.log('[LazyLoad] Loading component:', componentId);
                    try {
                        component.initFunction();
                        component.initialized = true;
                        console.log('[LazyLoad] Component loaded successfully:', componentId);
                    } catch (error) {
                        console.error('[LazyLoad] Failed to load component:', componentId, error);
                    }
                }
            }

            initializeDebugConsole() {
                // Initialize debug console only when needed
                const debugContent = document.getElementById('debugContent');
                if (debugContent && !debugContent.getAttribute('data-initialized')) {
                    debugContent.setAttribute('data-initialized', 'true');
                    // Additional heavy debug console initialization can go here
                    console.log('[LazyLoad] Debug console initialized');
                }
            }

            initializeAdvancedSettings() {
                // Initialize advanced settings panel only when accessed
                const advancedSettings = document.querySelector('.advanced-settings');
                if (advancedSettings && !advancedSettings.getAttribute('data-initialized')) {
                    advancedSettings.setAttribute('data-initialized', 'true');
                    // Additional heavy settings initialization can go here  
                    console.log('[LazyLoad] Advanced settings initialized');
                }
            }

            // Adaptive polling system - adjusts frequency based on activity
            startAdaptivePolling() {
                const scheduleNextPoll = () => {
                    if (this.intervals && this.intervals.has) {
                        this.intervals.clear('statusPoll');
                        this.intervals.set('statusPoll', () => {
                            this.pollStatus().then(() => {
                                scheduleNextPoll(); // Schedule next poll with updated interval
                            }).catch(() => {
                                scheduleNextPoll(); // Continue even on error
                            });
                        }, this.stateManagement.adaptivePollInterval);
                    } else {
                        // Fallback if intervals system not ready
                        setTimeout(() => {
                            this.pollStatus().then(() => {
                                scheduleNextPoll();
                            }).catch(() => {
                                scheduleNextPoll();
                            });
                        }, this.stateManagement.adaptivePollInterval);
                    }
                };
                
                // Start the adaptive polling
                scheduleNextPoll();
                console.log('[Polling] Adaptive polling started with initial interval:', this.stateManagement.adaptivePollInterval + 'ms');
            }

            // Public UI Update Function (uses debouncing)
            updateAllUI() {
                this.stateManagement.updateUIDebounced();
            }

            _updateAllUI() {
                debugLog('Updating all UI elements...', 'UI');
                if (this.stateManagement.isUpdatingUI) {
                    debugLog('Skipping UI update: already updating', 'UI');
                    return;
                }
                this.stateManagement.isUpdatingUI = true;

                try {
                    // Update connection status
                    this.elements.connectionLed.classList.toggle('connected', this.state.isConnected);
                    this.elements.connectionLed.classList.toggle('connecting', this.state.phase === 'CONNECT');
                    this.elements.connectionText.textContent = this.state.isConnected ? 'ONLINE' : 'OFFLINE';

                    // Update primary action button
                    if (this.state.isConnected && !this.state.isRunning) {
                        this.elements.primaryActionButton.textContent = 'üöÄ START BACKUP';
                        this.elements.primaryActionButton.classList.remove('primary');
                        this.elements.primaryActionButton.classList.add('success');
                        this.elements.primaryActionButton.disabled = false;
                    } else if (this.state.isRunning) {
                        this.elements.primaryActionButton.textContent = 'üîÑ BACKING UP...';
                        this.elements.primaryActionButton.classList.remove('success');
                        this.elements.primaryActionButton.classList.add('primary');
                        this.elements.primaryActionButton.disabled = true;
                    } else {
                        this.elements.primaryActionButton.textContent = 'üöÄ CONNECT';
                        this.elements.primaryActionButton.classList.remove('success');
                        this.elements.primaryActionButton.classList.add('primary');
                        this.elements.primaryActionButton.disabled = false;
                    }

                    // Update pause/stop buttons
                    this.elements.pauseButton.disabled = !this.state.isRunning;
                    this.elements.stopButton.disabled = !this.state.isRunning;
                    this.elements.pauseButton.textContent = this.state.isPaused ? '‚ñ∂Ô∏è RESUME' : '‚è∏Ô∏è PAUSE';
                    this.elements.pauseButton.classList.toggle('primary', this.state.isPaused);
                    this.elements.pauseButton.classList.toggle('secondary', !this.state.isPaused);

                    // Update phase display
                    this.elements.currentPhaseDisplay.querySelector('span').textContent = this.state.phase.replace(/_/g, ' ');
                    this.elements.currentPhaseDisplay.querySelector('span').className = `neon-text ${this.getPhaseColor(this.state.phase)}`;

                    // Update progress ring
                    const radius = this.elements.progressCircle.r.baseVal.value;
                    const circumference = radius * 2 * Math.PI;
                    const offset = circumference - (this.state.progress / 100) * circumference;
                    this.elements.progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
                    this.elements.progressCircle.style.strokeDashoffset = offset;
                    this.elements.progressCircle.classList.toggle('active', this.state.isRunning);

                    this.elements.progressPercentage.textContent = `${Math.round(this.state.progress)}%`;
                    this.elements.progressStatus.textContent = this.state.log.operation || this.state.message;

                    // Update stats grid
                    this.elements.speedStat.textContent = this.formatBytesPerSecond(this.state.speed);
                    this.elements.etaStat.textContent = this.formatTime(this.state.eta);
                    this.elements.transferredStat.textContent = this.formatBytes(this.state.transferred);
                    this.elements.sizeStat.textContent = this.formatBytes(this.state.file_size);

                    // Update selected file display
                    if (this.state.selectedFile) {
                        this.elements.selectedFileDisplay.innerHTML = `
                            <span class="file-icon neon-text blue">üìÑ</span>
                            <div class="file-details">
                                <div class="file-name">${this.state.selectedFile.name}</div>
                                <div class="file-size">${this.formatBytes(this.state.selectedFile.size)}</div>
                            </div>
                        `;
                        this.elements.selectedFileDisplay.classList.add('file-info');
                        this.elements.filePreview.innerHTML = ''; // Clear previous preview
                        this.elements.filePreview.style.display = 'flex';
                        this.renderFilePreview(this.state.selectedFile);
                    } else {
                        this.elements.selectedFileDisplay.textContent = 'No file selected';
                        this.elements.selectedFileDisplay.classList.remove('file-info');
                        this.elements.filePreview.style.display = 'none';
                    }

                    // Update client ID
                    this.elements.clientIdDisplay.textContent = this.state.clientId ? this.state.clientId.substring(0, 8) + '...' : 'Not connected';

                    // Update debug JSON viewers
                    if (this.elements.statusJsonViewer) {
                        this.elements.statusJsonViewer.textContent = JSON.stringify(this.state.lastApiStatus, null, 2);
                    }
                    if (this.elements.progressJsonViewer) {
                        this.elements.progressJsonViewer.textContent = JSON.stringify(this.state, null, 2);
                    }

                } catch (error) {
                    console.error('Error updating UI:', error);
                    debugLog('Error updating UI: ' + error.message, 'ERROR');
                } finally {
                    this.stateManagement.isUpdatingUI = false;
                }
            }

            getPhaseColor(phase) {
                switch (phase) {
                    case 'SYSTEM_READY': return 'purple';
                    case 'CONNECT': return 'blue';
                    case 'CONNECTED': return 'green';
                    case 'START': return 'blue';
                    case 'BACKING_UP': return 'blue';
                    case 'VERIFY': return 'yellow';
                    case 'COMPLETED': return 'green';
                    case 'SUCCESS': return 'green';
                    case 'PAUSED': return 'yellow';
                    case 'STOPPED': return 'pink';
                    case 'FAILED': return 'red';
                    case 'ERROR': return 'red';
                    case 'CONNECTION_FAILED': return 'red';
                    case 'SERVER_OFFLINE': return 'red';
                    default: return 'purple';
                }
            }

            async handlePrimaryAction() {
                if (!this.state.isConnected) {
                    // Connect to server
                    const serverAddress = this.elements.serverInput.value;
                    const username = this.elements.usernameInput.value;
                    const [serverIP, serverPortStr] = serverAddress.split(':');
                    const serverPort = parseInt(serverPortStr);

                    if (!serverIP || isNaN(serverPort) || !username) {
                        this.showToast('Please enter valid server address and username.', 'error');
                        this.addLog('Connection failed', 'error', 'Invalid server address or username.');
                        return;
                    }

                    this.addLog(`Attempting to connect to ${serverIP}:${serverPort} as ${username}...`, 'info');
                    this.state.phase = 'CONNECT';
                    this.state.log = { operation: 'Connecting...', success: true, details: '' };
                    this.updateAllUI();

                    try {
                        const result = await this.apiClient.connect({ host: serverIP, port: serverPort, username: username });
                        if (result.success) {
                            this.showToast('Connected to server successfully!', 'success');
                            this.addLog('Connected to server', 'success', `Server: ${serverIP}:${serverPort}`);
                            this.state.isConnected = true;
                            this.state.phase = 'CONNECTED';
                            this.state.log = { operation: 'Ready for backup', success: true, details: '' };
                            this.updateAllUI();
                        } else {
                            this.showToast(`Connection failed: ${result.message}`, 'error');
                            this.addLog('Connection failed', 'error', result.message);
                            this.state.isConnected = false;
                            this.state.phase = 'CONNECTION_FAILED';
                            this.state.log = { operation: 'Connection Failed', success: false, details: result.message };
                            this.updateAllUI();
                        }
                    } catch (error) {
                        this.showToast(`API Error: ${error.message}`, 'error');
                        this.addLog('API Error', 'error', error.message);
                        this.state.isConnected = false;
                        this.state.phase = 'ERROR';
                        this.state.log = { operation: 'API Error', success: false, details: error.message };
                        this.updateAllUI();
                    }
                } else if (this.state.isConnected && !this.state.isRunning) {
                    // Start backup
                    if (!this.state.selectedFile) {
                        this.showToast('Please select a file to backup first.', 'warning');
                        this.addLog('Backup failed', 'warning', 'No file selected.');
                        return;
                    }

                    const confirm = await this.system.confirmModal.confirm(
                        'Confirm Backup',
                        `Are you sure you want to backup "${this.state.selectedFile.name}" to ${this.elements.serverInput.value}?`
                    );

                    if (confirm) {
                        this.addLog(`Starting backup of ${this.state.selectedFile.name}...`, 'info');
                        this.state.isRunning = true;
                        this.state.phase = 'START';
                        this.state.log = { operation: 'Initiating backup', success: true, details: '' };
                        this.updateAllUI();

                        try {
                            const result = await this.apiClient.startBackup(
                                this.state.selectedFile,
                                { 
                                    username: this.elements.usernameInput.value,
                                    serverIP: this.elements.serverInput.value.split(':')[0],
                                    serverPort: parseInt(this.elements.serverInput.value.split(':')[1])
                                }
                            );
                            if (result.success) {
                                this.showToast('Backup process started!', 'success');
                                this.addLog('Backup initiated', 'success', `File: ${result.filename}`);
                                // Status polling will update the rest
                            } else {
                                this.showToast(`Backup failed: ${result.message}`, 'error');
                                this.addLog('Backup failed', 'error', result.message);
                                this.state.isRunning = false;
                                this.state.phase = 'FAILED';
                                this.state.log = { operation: 'Backup Failed', success: false, details: result.message };
                                this.updateAllUI();
                            }
                        } catch (error) {
                            this.showToast(`API Error: ${error.message}`, 'error');
                            this.addLog('API Error', 'error', error.message);
                            this.state.isRunning = false;
                            this.state.phase = 'ERROR';
                            this.state.log = { operation: 'API Error', success: false, details: error.message };
                            this.updateAllUI();
                        }
                    } else {
                        this.addLog('Backup cancelled by user', 'info');
                        this.showToast('Backup cancelled.', 'info');
                    }
                }
            }

            async togglePause() {
                if (this.state.isRunning) {
                    if (this.state.isPaused) {
                        this.addLog('Resuming backup...', 'info');
                        this.state.phase = 'RESUME';
                        this.state.log = { operation: 'Resuming backup', success: true, details: '' };
                        this.updateAllUI();
                        try {
                            const result = await this.apiClient.resumeBackup();
                            if (result.success) {
                                this.showToast('Backup resumed!', 'info');
                                this.addLog('Backup resumed', 'success');
                                this.state.isPaused = false;
                                this.state.phase = 'BACKING_UP';
                                this.state.log = { operation: 'Backing up...', success: true, details: '' };
                                this.updateAllUI();
                            } else {
                                this.showToast(`Resume failed: ${result.message}`, 'error');
                                this.addLog('Resume failed', 'error', result.message);
                            }
                        } catch (error) {
                            this.showToast(`API Error: ${error.message}`, 'error');
                            this.addLog('API Error', 'error', error.message);
                        }
                    } else {
                        this.addLog('Pausing backup...', 'info');
                        this.state.phase = 'PAUSE';
                        this.state.log = { operation: 'Pausing backup', success: true, details: '' };
                        this.updateAllUI();
                        try {
                            const result = await this.apiClient.pauseBackup();
                            if (result.success) {
                                this.showToast('Backup paused!', 'warning');
                                this.addLog('Backup paused', 'warning');
                                this.state.isPaused = true;
                                this.state.phase = 'PAUSED';
                                this.state.log = { operation: 'Backup paused', success: true, details: '' };
                                this.updateAllUI();
                            } else {
                                this.showToast(`Pause failed: ${result.message}`, 'error');
                                this.addLog('Pause failed', 'error', result.message);
                            }
                        } catch (error) {
                            this.showToast(`API Error: ${error.message}`, 'error');
                            this.addLog('API Error', 'error', error.message);
                        }
                    }
                }
            }

            async stopBackup() {
                if (this.state.isRunning) {
                    const confirm = await this.system.confirmModal.confirm(
                        'Confirm Stop',
                        'Are you sure you want to stop the current backup operation?'
                    );

                    if (confirm) {
                        this.addLog('Stopping backup...', 'info');
                        this.state.phase = 'STOP';
                        this.state.log = { operation: 'Stopping backup', success: true, details: '' };
                        this.updateAllUI();
                        try {
                            const result = await this.apiClient.stopBackup();
                            if (result.success) {
                                this.showToast('Backup stopped!', 'info');
                                this.addLog('Backup stopped', 'info');
                                this.state.isRunning = false;
                                this.state.isPaused = false;
                                this.state.progress = 0;
                                this.state.phase = 'STOPPED';
                                this.state.log = { operation: 'Backup stopped', success: true, details: '' };
                                this.updateAllUI();
                            } else {
                                this.showToast(`Stop failed: ${result.message}`, 'error');
                                this.addLog('Stop failed', 'error', result.message);
                            }
                        } catch (error) {
                            this.showToast(`API Error: ${error.message}`, 'error');
                            this.addLog('API Error', 'error', error.message);
                        }
                    }
                } else {
                    this.addLog('Stop cancelled by user', 'info');
                    this.showToast('Stop cancelled.', 'info');
                }
            }

            handleFileSelection(file) {
                debugLog('File selected:' + file.name, 'FILE_MANAGER');
                this.state.selectedFile = file;
                this.updateAllUI();
                this.addLog(`File selected: ${file.name}`, 'info', `Size: ${this.formatBytes(file.size)}`);
            }

            renderFilePreview(file) {
                const previewContainer = this.elements.filePreview;
                previewContainer.innerHTML = '';

                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.style.maxWidth = '100px';
                    img.style.maxHeight = '100px';
                    img.style.borderRadius = 'var(--radius-sm)';
                    img.style.border = '1px solid var(--glass-border)';
                    previewContainer.appendChild(img);
                } else if (file.type === 'application/pdf') {
                    const icon = document.createElement('span');
                    icon.className = 'file-icon-large neon-text purple';
                    icon.textContent = 'üìÑ';
                    const text = document.createElement('span');
                    text.textContent = 'PDF Document';
                    text.style.color = 'var(--text-secondary)';
                    previewContainer.appendChild(icon);
                    previewContainer.appendChild(text);
                } else if (file.type.startsWith('text/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const content = e.target.result;
                        const previewText = document.createElement('pre');
                        previewText.textContent = content.substring(0, 100) + (content.length > 100 ? '...' : '');
                        previewText.style.cssText = `
                            font-family: 'Share Tech Mono', monospace;
                            font-size: 0.75rem;
                            color: var(--text-dim);
                            background: var(--bg-black);
                            padding: var(--space-sm);
                            border-radius: var(--radius-sm);
                            max-height: 80px;
                            overflow: hidden;
                            white-space: pre-wrap;
                            word-break: break-all;
                        `;
                        previewContainer.appendChild(previewText);
                    };
                    reader.readAsText(file);
                } else {
                    const icon = document.createElement('span');
                    icon.className = 'file-icon-large neon-text blue';
                    icon.textContent = 'üóÑÔ∏è';
                    const text = document.createElement('span');
                    text.textContent = 'Binary File';
                    text.style.color = 'var(--text-secondary)';
                    previewContainer.appendChild(icon);
                    previewContainer.appendChild(text);
                }
            }

            addLog(message, type = 'info', details = '') {
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${type}`;
                logEntry.setAttribute('tabindex', '0'); // Make it focusable
                logEntry.innerHTML = `
                    <span class="log-timestamp">${new Date().toLocaleTimeString()}</span>
                    <span class="log-icon ${type}">${this.getLogIcon(type)}</span>
                    <div class="log-content">
                        <div class="log-message">${message}</div>
                        ${details ? `<div class="log-details">${details}</div>` : ''}
                    </div>
                `;
                this.elements.logContainer.prepend(logEntry); // Add to top

                // Limit log entries
                while (this.elements.logContainer.children.length > 200) {
                    this.elements.logContainer.removeChild(this.elements.logContainer.lastChild);
                }

                if (this.autoScrollLog) {
                    this.elements.logContainer.scrollTop = 0; // Scroll to top for prepend
                }

                // Announce to screen readers
                this.system.announce(`${type} log: ${message}. ${details}`);
            }

            getLogIcon(type) {
                switch (type) {
                    case 'success': return '‚úÖ';
                    case 'error': return '‚ùå';
                    case 'warning': return '‚ö†Ô∏è';
                    case 'info': return '‚ÑπÔ∏è';
                    default: return 'üí¨';
                }
            }

            clearLog() {
                this.elements.logContainer.innerHTML = '';
                this.addLog('Log cleared', 'info');
                this.showToast('Operation log cleared.', 'info');
            }

            exportLog() {
                const logEntries = Array.from(this.elements.logContainer.children).map(entryDiv => {
                    const timestamp = entryDiv.querySelector('.log-timestamp').textContent;
                    const message = entryDiv.querySelector('.log-message').textContent;
                    const details = entryDiv.querySelector('.log-details') ? entryDiv.querySelector('.log-details').textContent : '';
                    const type = entryDiv.classList.contains('success') ? 'SUCCESS' :
                                 entryDiv.classList.contains('error') ? 'ERROR' :
                                 entryDiv.classList.contains('warning') ? 'WARNING' : 'INFO';
                    return `[${timestamp}] [${type}] ${message} ${details}`.trim();
                }).reverse(); // Reverse to get chronological order

                const blob = new Blob([logEntries.join('\n')], { type: 'text/plain;charset=utf-8' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `cyberbackup_log_${new Date().toISOString().slice(0,10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                this.showToast('Log exported successfully.', 'success');
            }

            toggleAutoScroll() {
                this.autoScrollLog = !this.autoScrollLog;
                this.elements.autoScrollBtn.textContent = `üìú Auto-scroll: ${this.autoScrollLog ? 'ON' : 'OFF'}`;
                this.showToast(`Auto-scroll ${this.autoScrollLog ? 'enabled' : 'disabled'}.`, 'info');
            }

            toggleDebugConsole() {
                const debugPanel = document.querySelector('.debug-panel');
                const debugContent = this.elements.debugContent;
                const isExpanded = this.elements.debugToggle.getAttribute('aria-expanded') === 'true';

                if (isExpanded) {
                    debugPanel.style.maxHeight = '0';
                    debugContent.classList.remove('show');
                    this.elements.debugToggle.setAttribute('aria-expanded', 'false');
                } else {
                    debugPanel.style.maxHeight = debugPanel.scrollHeight + 'px'; // Set to actual height
                    debugContent.classList.add('show');
                    this.elements.debugToggle.setAttribute('aria-expanded', 'true');
                    this.system.loadLazyComponent('debugConsole'); // Lazy load debug console content
                }
            }

            showToast(message, type = 'info', duration = 3000) {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div class="toast-content">
                        <span class="toast-message">${message}</span>
                        <button class="toast-close" aria-label="Close notification">&times;</button>
                    </div>
                `;
                this.elements.toastContainer.prepend(toast); // Add to top

                toast.querySelector('.toast-close').addEventListener('click', () => {
                    toast.style.animation = 'toast-slide-out 0.4s forwards';
                    toast.addEventListener('animationend', () => toast.remove());
                });

                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.style.animation = 'toast-slide-out 0.4s forwards';
                        toast.addEventListener('animationend', () => toast.remove());
                    }
                }, duration);
            }

            formatBytes(bytes) {
                if (bytes === 0) return '0 B';
                const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
                const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
                return Math.round(bytes / Math.pow(1024, i), 2) + ' ' + sizes[i];
            }

            formatBytesPerSecond(bytesPerSecond) {
                if (bytesPerSecond === 0) return '0 B/s';
                const sizes = ['B/s', 'KB/s', 'MB/s', 'GB/s', 'TB/s'];
                const i = parseInt(Math.floor(Math.log(bytesPerSecond) / Math.log(1024)));
                return Math.round(bytesPerSecond / Math.pow(1024, i), 2) + ' ' + sizes[i];
            }

            formatTime(seconds) {
                if (seconds === '--:--') return seconds; // Handle initial state
                if (seconds < 0) return '--:--';
                const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
                const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
                const s = Math.floor(seconds % 60).toString().padStart(2, '0');
                return `${h}:${m}:${s}`;
            }

            saveConfig() {
                const config = {
                    serverAddress: this.elements.serverInput.value,
                    username: this.elements.usernameInput.value,
                };
                localStorage.setItem('cyberbackup_config', JSON.stringify(config));
                this.showToast('Configuration saved!', 'success');
                this.addLog('Configuration saved', 'info');
            }

            loadSavedConfig() {
                try {
                    const savedConfig = localStorage.getItem('cyberbackup_config');
                    if (savedConfig) {
                        const config = JSON.parse(savedConfig);
                        this.elements.serverInput.value = config.serverAddress || '127.0.0.1:1256';
                        this.elements.usernameInput.value = config.username || 'testuser';
                        this.addLog('Loaded saved configuration', 'info');
                    }
                } catch (error) {
                    console.warn('Failed to load saved config:', error);
                    this.addLog('Failed to load config', 'warning', error.message);
                }
            }

            debounce(func, delay) {
                let timeout;
                return function(...args) {
                    const context = this;
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(context, args), delay);
                };
            }
        }
        debugLog('App class defined successfully');

        /**
         * NEW: ThemeManager
         * Handles dynamic theme switching.
         */
        debugLog('Defining ThemeManager class...');
        class ThemeManager {
            constructor() {
                this.themes = {
                    cyberpunk: {
                        '--neon-pink': '#FF00FF',
                        '--neon-blue': '#00FFFF',
                        '--neon-purple': '#8A2BE2',
                        '--neon-green': '#00FF00',
                        '--neon-yellow': '#FFFF00',
                        '--neon-orange': '#FF4500',
                        '--neon-red': '#FF0040',
                        '--electric-blue': '#0080FF',
                        '--cyber-lime': '#32CD32',
                        '--plasma-pink': '#FF1493',
                        '--bg-black': '#000000',
                        '--bg-dark': '#0A0A0A',
                        '--bg-medium': '#1A1A2E',
                        '--bg-light': '#16213E',
                        '--bg-card': 'rgba(26, 26, 46, 0.95)',
                        '--bg-glass': 'rgba(255, 255, 255, 0.05)',
                        '--text-primary': '#FFFFFF',
                        '--text-secondary': '#E0E0E0',
                        '--text-dim': '#888888',
                        '--text-contrast': 'rgba(0, 0, 0, 0.8)',
                        '--glass-border': 'rgba(255, 255, 255, 0.2)',
                        '--glass-border-active': 'rgba(0, 255, 255, 0.6)',
                    },
                    dark: {
                        '--neon-pink': '#FF69B4',
                        '--neon-blue': '#6495ED',
                        '--neon-purple': '#9370DB',
                        '--neon-green': '#3CB371',
                        '--neon-yellow': '#FFD700',
                        '--neon-orange': '#FF8C00',
                        '--neon-red': '#DC143C',
                        '--electric-blue': '#4169E1',
                        '--cyber-lime': '#6B8E23',
                        '--plasma-pink': '#FF6347',
                        '--bg-black': '#121212',
                        '--bg-dark': '#1E1E1E',
                        '--bg-medium': '#2C2C2C',
                        '--bg-light': '#3A3A3A',
                        '--bg-card': 'rgba(44, 44, 44, 0.95)',
                        '--bg-glass': 'rgba(255, 255, 255, 0.03)',
                        '--text-primary': '#E0E0E0',
                        '--text-secondary': '#B0B0B0',
                        '--text-dim': '#777777',
                        '--text-contrast': 'rgba(0, 0, 0, 0.7)',
                        '--glass-border': 'rgba(255, 255, 255, 0.1)',
                        '--glass-border-active': 'rgba(100, 149, 237, 0.6)',
                    },
                    matrix: {
                        '--neon-pink': '#00FF41', /* Green */
                        '--neon-blue': '#00FF41', /* Green */
                        '--neon-purple': '#00FF41', /* Green */
                        '--neon-green': '#00FF41', /* Green */
                        '--neon-yellow': '#00FF41', /* Green */
                        '--neon-orange': '#00FF41', /* Green */
                        '--neon-red': '#00FF41', /* Green */
                        '--electric-blue': '#00FF41', /* Green */
                        '--cyber-lime': '#00FF41', /* Green */
                        '--plasma-pink': '#00FF41', /* Green */
                        '--bg-black': '#000000',
                        '--bg-dark': '#000000',
                        '--bg-medium': '#000000',
                        '--bg-light': '#000000',
                        '--bg-card': 'rgba(0, 0, 0, 0.9)',
                        '--bg-glass': 'rgba(0, 255, 0, 0.05)',
                        '--text-primary': '#00FF41',
                        '--text-secondary': '#00AA00',
                        '--text-dim': '#006600',
                        '--text-contrast': 'rgba(0, 0, 0, 0.9)',
                        '--glass-border': 'rgba(0, 255, 0, 0.2)',
                        '--glass-border-active': 'rgba(0, 255, 0, 0.6)',
                    }
                };
                this.currentTheme = 'cyberpunk';
            }

            setTheme(themeName) {
                if (this.themes[themeName]) {
                    const theme = this.themes[themeName];
                    for (const [prop, value] of Object.entries(theme)) {
                        document.documentElement.style.setProperty(prop, value);
                    }
                    this.currentTheme = themeName;
                    this.updateActiveThemeButton();
                    localStorage.setItem('cyberbackup_theme', themeName);
                    debugLog(`Theme set to: ${themeName}`, 'THEME');
                }
            }

            loadSavedTheme() {
                const savedTheme = localStorage.getItem('cyberbackup_theme');
                if (savedTheme && this.themes[savedTheme]) {
                    this.setTheme(savedTheme);
                } else {
                    this.setTheme(this.currentTheme); // Apply default if no saved theme or invalid
                }
            }

            updateActiveThemeButton() {
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    if (btn.classList.contains(this.currentTheme)) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
        }
        debugLog('ThemeManager class defined successfully');

        // Initialize the main application
        debugLog('Initializing App instance...');
        const app = new App();
        debugLog('App instance initialized.');

        // Initial UI update
        app.updateAllUI();

        debugLog('=== SCRIPT LOADING COMPLETE ===');
    </script>
</body>
</html>